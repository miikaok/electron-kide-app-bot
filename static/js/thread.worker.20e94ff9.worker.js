!function(){AbortSignal.timeout??=function(e){const t=new AbortController;return setTimeout((()=>t.close()),e),t.signal};const e=async({bearerToken:e,requestTimeout:t=5e3,variant:r,useCustomCount:s=!1,ticketBuyCount:n=0}={})=>{try{const a=Math.min(r.availability,r.productVariantMaximumReservableQuantity);if(0===a)return self.postMessage({type:"buy_failed"});const o=await(async({bearerToken:e,requestTimeout:t=5e3})=>{try{const r=await fetch("https://api.kide.app/api/reservations",{method:"GET",headers:{Authorization:`Bearer ${e}`,cache:"no-cache"},signal:AbortSignal.timeout(t)});if(r.ok){const e=await r.json(),t=e.model?.reservations;return null==t?[]:t.map((e=>e.inventoryId))}console.error(`Error fetching reservations: ${r.status} ${r.statusText}`)}catch(r){console.error("An error occurred while fetching reservations:",r)}return null})({bearerToken:e,requestTimeout:t});if(null===o||"undefined"===typeof o)return self.postMessage({type:"request_error"});if(self.postMessage({type:"request_success"}),o.includes(r.inventoryId))return self.postMessage({type:"in_cart"});const i=s?Math.min(n,a):a,u=await(async({bearerToken:e,inventoryId:t,quantity:r,requestTimeout:s})=>(await fetch("https://api.kide.app/api/reservations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,cache:"no-cache"},body:JSON.stringify({expectCart:!0,includeDeliveryMethods:!1,toCancel:null,toCreate:[{inventoryId:t,productVariantUserForm:null,quantity:String(r)}]}),signal:AbortSignal.timeout(s)})).ok)({bearerToken:e,inventoryId:r.inventoryId,quantity:i,requestTimeout:t});if(!u)return self.postMessage({type:"buy_failed"});self.postMessage({type:"buy_success"})}catch(a){console.error("An error occurred while processing the shopping request:",a),self.postMessage({type:"buy_failed"})}},t=(t,r,s)=>{for(const n of t){const{value:t}=n,a=r.find((e=>e.name.toLowerCase().includes(t.toLowerCase())));if(null!=a)return self.postMessage({type:"buy_attempt",value:a.name}),e({...s,variant:a}),!0}return!1};self.addEventListener("message",(({data:{eventID:r,threadDelay:s,requestTimeout:n,strictPriority:a,priorityItems:o,bearerToken:i,useCustomCount:u,ticketBuyCount:l}})=>{setInterval((async()=>{const s=await(async(e,t=5e3)=>{try{const r=await fetch(`https://api.kide.app/api/products/${e}`,{method:"GET",headers:{"cache-control":"no-cache"},signal:AbortSignal.timeout(t)});if(r.ok)return r.json()}catch(r){return console.error(`Error fetching event data for eventID ${e}:`,r),null}})(r,n);if(self.postMessage({type:"request_start"}),null===s)return self.postMessage({type:"request_error"});const c=s.model.variants.filter((e=>new Date(e.dateSalesFrom)<new Date&&e.availability>0));if(0===c.length)return self.postMessage({type:"no_available_variants"});if(o.length>0){if(!t(o,c,{bearerToken:i,requestTimeout:n,useCustomCount:u,ticketBuyCount:l})&&a)return self.postMessage({type:"strict_skip"})}const p=Math.floor(Math.random()*c.length);return self.postMessage({type:"buy_attempt",value:c[p].name}),e({bearerToken:i,requestTimeout:n,variant:c[p],useCustomCount:u,ticketBuyCount:l})}),s)}))}();
//# sourceMappingURL=thread.worker.20e94ff9.worker.js.map